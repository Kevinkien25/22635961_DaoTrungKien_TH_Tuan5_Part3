<%- include('partials/header') %>

    <h1>Dashboard</h1>

    <form action="/search" method="get" style="margin-bottom:12px">
        <input type="text" name="q" placeholder="Search product name" value="<%= query || '' %>" />
        <select name="supplier">
    <option value="">All suppliers</option>
    <% suppliers.forEach(s => { %>
      <option value="<%= s._id %>"><%= s.name %></option>
    <% }) %>
  </select>
        <button class="btn btn-primary">Search</button>
    </form>

    <section>
        <h2>Products <a href="/products/new" class="btn btn-primary">+ New</a></h2>
        <table class="list-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>Supplier</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(p => { %>
                    <tr>
                        <td>
                            <%= p.name %>
                        </td>
                        <td>
                            <%= p.price %>
                        </td>
                        <td>
                            <%= p.quantity %>
                        </td>
                        <td>
                            <%= p.supplier ? p.supplier.name : '' %>
                        </td>
                        <td>
                            <a href="/products/<%= p._id %>/edit" class="btn btn-warning">Edit</a>
                            <form method="POST" action="/products/<%= p._id %>?_method=DELETE" style="display:inline">
                                <button class="btn btn-danger" onclick="return confirm('Delete product?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </section>

    <section>
        <h2>Suppliers <a href="/suppliers/new" class="btn btn-primary">+ New</a></h2>
        <table class="list-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% suppliers.forEach(s => { %>
                    <tr>
                        <td>
                            <%= s.name %>
                        </td>
                        <td>
                            <%= s.phone %>
                        </td>
                        <td>
                            <%= s.address %>
                        </td>
                        <td>
                            <a href="/suppliers/<%= s._id %>/edit" class="btn btn-warning">Edit</a>
                            <form method="POST" action="/suppliers/<%= s._id %>?_method=DELETE" style="display:inline">
                                <button class="btn btn-danger" onclick="return confirm('Delete supplier?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </section>

    <%- include('partials/footer') %>